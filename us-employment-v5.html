<!doctype html>
<html class="no-js" lang="">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <!-- Place favicon.ico in the root directory -->

    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/nvd3.css">
    <script src="js/modernizer/modernizr-2.6.2.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="js/d3/nvd3.js"></script>
    <link rel="stylesheet" href="css/us-employment.css">

    <link href='http://fonts.googleapis.com/css?family=Roboto+Slab:400,700,300' rel='stylesheet' type='text/css'>
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,300,400italic,400,600italic,600,700italic,700,800italic,800" rel="stylesheet" type="text/css">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">

    <style>

    /*h1 {
        font-family: 'arial',sans-serif;
        padding: 0 70px;
        color: #777;
    }

    #chart-title-controls {
        float: right;
    }

    #chart-title {
        font-family: 'arial',sans-serif;
        color: #777;
        margin: 0px;
        float: right;
    }

    #chart-refresh svg {
        height: 24px;
        width: 32px;
        padding-right: 80px;
        float: right;
        cursor: pointer;
    }

    #chart {
        float: right;
        clear: both;
    }

    #chart svg {
      height: 400px;
      width: 600px;
      float: right;
    }*/

    </style>
</head>

<body>
    <!--[if lt IE 8]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

    <!-- Add your site or application content here -->
    <div id="header">
    <h1>An Historical Exploration of the U.S. Jobs Landscape</h1>
    <h2>Providing Insight into the Past 20 Years of the Labor Market</h2>
    </div>

    <div id="leadin-wrapper">
        <div id="col33-left">
            <p>As of January 2014 there were roughly 137 million jobs in this country. About two-thirds of those jobs are in private-sector services; the remaining third are split between goods-producing jobs (mainly manufacturing and construction) and government work (mostly at the state and local level).
            </p>
        </div>
        <div id="col33-right">
            <p>Here's a closer look, drawn from the same data that the government collects for the monthly jobs report. (You can see this data, in glorious detail, here.)</p>
        </div>
    </div>

    <!-- <svg style="height: 20px; padding: 20px 0;"><line x1="0" x2="2400" y1="10" y2="10" stroke="#5184AF" stroke-width="10" stroke-linecap="round" stroke-dasharray="1, 20"></line></svg> -->

    <div id="spacer"></div>

    <div id="content-wrapper">

    <div id="col33-right" class="float-right">
        <div id="chart-refresh">
            <svg>
            <path fill="#E9E9EA" d="M15.4,17.7l3.7-3.9l1.8,1.7l2.9-3.3l2,1.7l1.5-1.9l1.1,1.4c0,2.5,0,2.8,0,4.3C24.3,17.7,23.9,17.7,15.4,17.7 z"/>
                <line fill="none" stroke="#A7A9AC" stroke-width="0.25" stroke-miterlimit="10" x1="17.1" y1="16.6" x2="17.1" y2="17.7"/>
                <line fill="none" stroke="#A7A9AC" stroke-width="0.25" stroke-miterlimit="10" x1="18.9" y1="14.7" x2="18.9" y2="17.7"/>
                <line fill="none" stroke="#A7A9AC" stroke-width="0.25" stroke-miterlimit="10" x1="20.8" y1="15.5" x2="20.8" y2="17.7"/>
                <line fill="none" stroke="#A7A9AC" stroke-width="0.25" stroke-miterlimit="10" x1="22.7" y1="14.1" x2="22.7" y2="17.7"/>
                <line fill="none" stroke="#A7A9AC" stroke-width="0.25" stroke-miterlimit="10" x1="24.6" y1="13.7" x2="24.6" y2="17.7"/>
                <line fill="none" stroke="#A7A9AC" stroke-width="0.25" stroke-miterlimit="10" x1="26.5" y1="13.7" x2="26.5" y2="17.7"/>
                <polyline fill="none" stroke="#3C64A0" stroke-miterlimit="10" points="15.2,17.6 19,13.8 20.8,15.6 23.7,12.2 25.7,13.9 27.1,12.2 
                    28.3,13.4 "/>
                <g id="Editor" sketch:type="MSPage">
                    <path id="redo" sketch:type="MSShapeGroup" fill="#686868" stroke="#686868" stroke-miterlimit="10" d="M30.5,14.9
                        c0,4.7-3.8,8.5-8.5,8.5s-8.5-3.8-8.5-8.5s3.8-8.5,8.5-8.5v0.9c-4.1,0-7.5,3.4-7.5,7.5s3.4,7.5,7.5,7.5s7.5-3.4,7.5-7.5H30.5
                        L30.5,14.9z M22,4.6v4.7L24.8,7L22,4.6z"/>
                </g>
            </svg>
        </div>

        <div id="chart-title-controls">
            <h2 id="chart-title">All Jobs in the United States (1994-2014)</h2>
        </div>

        <div id="chart">
          <svg id="chart-svg"></svg>
        </div>
    </div>

        <div id="section-header">
            <h2 id="section-title">How Did We Get Here?</h2>
        </div>
        <section id="section-1">
            <div class="svg-chart-container" id="construction">
            <svg version="1.1" id="chart-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
     viewBox="50.7 8.9 190 215.9" enable-background="new 50.7 8.9 190 215.9" xml:space="preserve">
            <g>
                <g transform="translate(0,0)">
                    <g>
                        <g>
                            <path fill="#83C2CF" fill-opacity="0.95" stroke="#83C2CF" stroke-opacity="0" d="M54.6,71.8l9.1-7.1l9.1-1.4l9.1-8.2l9.1-7.3
                                l9.1-9.6l9.1-9.9l9.1,4.8l9.1,1.6l9.1,0.8l9.1-2.1l9.1-9.5l9.1-13.9l9.1-1.2l9.1,8.6L191,45l9.1,29.9l9.1,4.9l9.1-3.5l9.1-3.4
                                l9.1-8.4v159.3h-9.1h-9.1h-9.1h-9.1H191h-9.1h-9.1h-9.1h-9.1h-9.1h-9.1h-9.1h-9.1h-9.1h-9.1H91h-9.1h-9.1h-9.1h-9.1V71.8z"/>
                        </g>
                        <g>
                            <g transform="translate(0,0)">
                                <g>
                                    <g>
                                        <g>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="54.6" cy="71.8" r="0.9"/>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="63.7" cy="64.7" r="0.9"/>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="72.8" cy="63.3" r="0.9"/>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="81.9" cy="55.1" r="0.9"/>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="91" cy="47.8" r="0.9"/>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="100.1" cy="38.2" r="0.9"/>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="109.2" cy="28.4" r="0.9"/>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="118.3" cy="33.2" r="0.9"/>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="127.3" cy="34.8" r="0.9"/>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="136.4" cy="35.5" r="0.9"/>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="145.5" cy="33.5" r="0.9"/>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="154.6" cy="23.9" r="0.9"/>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="163.7" cy="10.1" r="0.9"/>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="172.8" cy="8.9" r="0.9"/>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="181.9" cy="17.5" r="0.9"/>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="191" cy="45" r="0.9"/>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="200.1" cy="74.9" r="0.9"/>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="209.2" cy="79.8" r="0.9"/>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="218.2" cy="76.3" r="0.9"/>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="227.4" cy="72.9" r="0.9"/>
                                            <circle fill="#83C2CF" fill-opacity="0" stroke="#83C2CF" stroke-opacity="0" cx="236.4" cy="64.5" r="0.9"/>
                                        </g>
                                    </g>
                                </g>
                            </g>
                        </g>
                    </g>
                </g>
            </g>
            <g transform="translate(303)">
                <line fill="none" stroke="#FFFFFF" x1="-123.2" y1="223.8" x2="-123.2" y2="0.7"/>
            </g>
            </svg>
        </div>
        </section>
    </div>

<script>

$(document).ready(function() { 

    // Bind refresh event to refresh button
    $("#chart-refresh").on("click",function(){
        $("#chart-title").text("All Jobs in the United States (1994-2014)");
        redrawGraph("Refresh");
    });


//Test Color 1
/*var color = {
                all: [ 
                    "#CE4B0B", "#58044F", "#00468D" 
                ],
                "Goods":      [ "#FFD7BD", "#F9C7A9", "#F4B795", 
                                "#EEA881", "#E9986D", "#E3895A", 
                                "#DE7946", "#D86A32", "#D35A1E", 
                                "#CE4B0B"
                ],
                "Government": [ "#F1B0FF",  "#AD63B0", "#58044F"
                ],
                "Services": [   "#CCD2FE", "#B5C2F1", "#9EB2E4", 
                                "#88A3D8", "#7193CB", "#5A84BF", 
                                "#4474B2", "#2D65A6", "#165599", 
                                "#00468D"
                ]
            }*/

    var color = {
                all: [ 
                    "#428F9F", "#A15E80", "#00468D"
                ],
                "Goods": [ "#83C2CF","#428F9F","#025D6F" ],
                "Government": ["#CAA9E5", "#B595CF", "#A082BA", "#8C6EA4", "#775B8F", "#63487A" ],
                "Services": [
                    "#CCD2FE", "#B5C2F1", "#9EB2E4", 
                                "#88A3D8", "#7193CB", "#5A84BF", 
                                "#4474B2", "#2D65A6", "#165599", 
                                "#00468D"
                ]
            }

    d3.csv('data/_MASTER_Employment_Data.csv', function(data) {

        //Restructure the data
        transformed = data.map(function(obj){
            // Define the new object structure
            var result= {
                key: obj.key,
                category: obj.cat,
                subcategory: obj.subcat,
                level: +obj.level,
                values: []
            }
            // Iterate over data object, reassign keys to values array
            for (var key in obj) {
                //console.log(obj.key)
              if (obj.hasOwnProperty(key) && key !== "key" && !isNaN(key) ) {
                  result.values.push([+key, +obj[key]]);
              }
            }
            //console.log(result);
            return result;
        });

        var initialData = transformed.filter(function (obj) { 
            return obj.subcategory == "All Government" || 
                   obj.subcategory == "All Services" || 
                   obj.subcategory == "All Goods"; 
        })
        

        nv.addGraph(function() {
            var chart = nv.models.stackedAreaChart()
                          .margin({right: 100})
                          .x(function(d) { return d[0] })   //We can modify the data accessor functions...
                          .y(function(d) { return d[1] })   //...in case your data is formatted differently.
                          .useInteractiveGuideline(true)    //Tooltips which show all data points. Very nice!
                          .rightAlignYAxis(true)      //Let's move the y-axis to the right side.
                          .transitionDuration(500)
                          .showControls(true)       //Allow user to choose 'Stacked', 'Stream', 'Expanded' mode.
                          .clipEdge(false)
                          .showLegend(false)
                          .color( color.all );

            //Format x-axis labels with custom function.
            chart.xAxis
                .tickFormat(function(d) { 
                  return d3.time.format('%Y')(new Date(d*1000)) 
            }).tickValues([757482400,883712800,1009943200,1136173600,1262404000,1357098400]);

            chart.yAxis
                .tickFormat(d3.format(',.0f'));

            d3.select('#chart svg')
              .datum(initialData)
              .call(chart);

            d3.select('#chart .nv-x')
                .append("g")
                    .attr("transform", "translate(303)")
                .append("line")
                    .attr("y2","-540")
                    .attr("x2","0")
                    .style("stroke","#6F6F6F")
                    .style("stroke-width","1")
                    .classed("recession-line",true)

            d3.select('#chart .nv-x')    
                .append("text")
                    .text("Great Recession")
                    .attr("dy",".71em")
                    .attr("y","-540")
                    .attr("x","350")
                    .style("fill","#6F6F6F")
                    .style("text-anchor","middle")
                    .classed("recession",true)

            d3.select('#chart .nv-x')    
                .append("text")
                    .attr("transform", "rotate(-90,500,-200)")
                    .text("Jobs (000s)")
                    .attr("dy",".71em")
                    .attr("y","-200")
                    .attr("x","500")
                    .style("fill","#666")
                    .style("text-anchor","middle")
                    .classed("recession",true)

            d3.select("#chart .nv-legendWrap")
                    .attr("transform","translate(-120,-140)")

            d3.selection.prototype.moveToFront = function() {
              return this.each(function(){
                this.parentNode.appendChild(this);
              });
            };

            d3.selectAll(".recession", function() {
                var sel = d3.select(this);
                sel.moveToFront;
            })


            nv.utils.windowResize(chart.update);

            ////////////////////////////////////
            // DRILLDOWN
            ////////////////////////////////////
            

            var areaClick = function() {
                chart.stacked.dispatch.on("areaClick.toggle", function(e) {
                    
                    var cat = e.point.subcategory;
                    var colorFilter = e.point.category.replace("All ","");
                    var subcat = cat.replace("All ","");
                    var key = e.point.key;
                    var level = e.point.level;
                    console.log(level)
                    console.log("Cat: ",cat)
                    console.log("Subcat: ",subcat)
                    console.log("Key: ",key)

                    //select the correct data depending on current level
                    if (e.point.level == 1) {
                        var data = transformed.filter(function (obj) { return obj.category == cat
                        && obj.subcategory !== cat })
                        var colorFilter = cat.replace("All ","");
                        $("#chart-title").text(subcat);
                    } else if (e.point.level == 2 ) {
                        var data = transformed.filter(function (obj) { return obj.subcategory == subcat })
                        $("#chart-title").text(subcat);
                    } else if (e.point.level == 3) {
                        var data = transformed.filter(function (obj) { return obj.key == key })
                        $("#chart-title").text(key);
                    } else {
                        redrawGraph(); 
                    }

                    console.log("Data: ",data)

                    //remove the current chart
                    d3.selectAll("svg > #chart-svg").remove();

                    //create the new chart
                    d3.select('#chart svg').datum(data)
                        .transition()
                        .duration(500)
                        .call(chart.color(color[colorFilter])); 

                    d3.select(".nv-legendWrap")
                        .attr("transform","translate(-120,-140)")

                    areaClick();

                    
                    
                })
            }

            redrawGraph = function(link) {
                console.log("Redraw")
                    d3.selectAll("svg > #chart-svg").remove();
                    
                    d3.select('#chart svg').datum(initialData)
                        .transition()
                        .duration(500)
                        .call(chart.color(color.all));

                    d3.select(".nv-legendWrap")
                        .attr("transform","translate(-120,-140)")

                    areaClick();
                  
            };

            $("#construction").on("click",function(){
                console.log("Click")
                var dataConstruction = transformed.filter(function (obj) { 
                    return obj.key == "Construction of Buildings"; 
                })

                d3.selectAll("svg > #chart-svg").remove();
                
                d3.select('#chart svg')
                      .datum(dataConstruction)
                      .call(chart.color(color["Goods"]));
            });


            //console.log(chart)
            areaClick();
            return chart;
        });
    });
})

</script>
</body>
</html>